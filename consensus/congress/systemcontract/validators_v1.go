package systemcontract

import (
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/consensus/congress/vmcaller"
	"github.com/ethereum/go-ethereum/core"
	"github.com/ethereum/go-ethereum/core/state"
	"github.com/ethereum/go-ethereum/core/types"
	"github.com/ethereum/go-ethereum/log"
	"github.com/ethereum/go-ethereum/params"
	"math"
	"math/big"
)

var (
	validatorV1Admin        = common.HexToAddress("")
	validatorV1AdminTestnet = common.HexToAddress("0x0dA5ac74D30D5b3c5ca9167A8666Ca98Fd58d9fb")
)

const (
	validatorV1Code = "0x608060405260043610620002125760003560e01c80638fffcbd0116200011b578063c885bc5811620000a3578063f04a5dcd116200006d578063f04a5dcd146200080c578063f3b1cc671462000287578063f40f0f52146200083d578063f851a44014620008745762000212565b8063c885bc5814620007bb578063c967f90f14620007d3578063d6c0edad1462000802578063ec0cb33614620002875762000212565b8063afeea11511620000e5578063afeea115146200070c578063bb8b65af1462000724578063bbc71680146200073c578063bcecf81b146200078d5762000212565b80638fffcbd0146200067b5780639001eed814620006c45780639cc02c3014620006dc5780639de7025814620006f45762000212565b80635274ac3f116200019f57806371a1bb75116200016957806371a1bb7514620005fc57806371df76781462000614578063741579b1146200062c5780638f28397014620006445762000212565b80635274ac3f146200035957806360544bf114620004a257806365f69f97146200050c5780636846992a14620005435762000212565b80631c0ffaa211620001e15780631c0ffaa2146200029f5780632e4f67e414620002875780633a82fd5e14620002de57806344f9990014620003255762000212565b806303fab4f61462000217578063136ec0b31462000241578063158ef93e146200025b57806315de360e1462000287575b600080fd5b3480156200022457600080fd5b506200022f6200088c565b60408051918252519081900360200190f35b3480156200024e57600080fd5b506200025962000898565b005b3480156200026857600080fd5b506200027362000ae3565b604080519115158252519081900360200190f35b3480156200029457600080fd5b506200022f62000aec565b348015620002ac57600080fd5b506200025960048036036040811015620002c557600080fd5b506001600160a01b038135169060200135151562000af1565b348015620002eb57600080fd5b506200030f600480360360208110156200030457600080fd5b503560ff1662000c11565b6040805160ff9092168252519081900360200190f35b3480156200033257600080fd5b506200033d62000c26565b604080516001600160a01b039092168252519081900360200190f35b3480156200036657600080fd5b5062000259600480360360608110156200037f57600080fd5b8101906020810181356401000000008111156200039b57600080fd5b820183602082011115620003ae57600080fd5b80359060200191846020830284011164010000000083111715620003d157600080fd5b91908080602002602001604051908101604052809392919081815260200183836020028082843760009201919091525092959493602081019350359150506401000000008111156200042257600080fd5b8201836020820111156200043557600080fd5b803590602001918460208302840111640100000000831117156200045857600080fd5b919080806020026020016040519081016040528093929190818152602001838360200280828437600092019190915250929550505090356001600160a01b0316915062000c2c9050565b348015620004af57600080fd5b50620004ba62001023565b60408051602080825283518183015283519192839290830191858101910280838360005b83811015620004f8578181015183820152602001620004de565b505050509050019250505060405180910390f35b3480156200051957600080fd5b506200033d600480360360208110156200053257600080fd5b50356001600160a01b031662001087565b3480156200055057600080fd5b5062000259600480360360408110156200056957600080fd5b8101906020810181356401000000008111156200058557600080fd5b8201836020820111156200059857600080fd5b80359060200191846020830284011164010000000083111715620005bb57600080fd5b9190808060200260200160405190810160405280939291908181526020018383602002808284376000920191909152509295505091359250620010a2915050565b3480156200060957600080fd5b506200033d62001553565b3480156200062157600080fd5b506200025962001559565b3480156200063957600080fd5b506200022f620016e8565b3480156200065157600080fd5b5062000259600480360360208110156200066a57600080fd5b50356001600160a01b0316620016f4565b3480156200068857600080fd5b506200025960048036036080811015620006a157600080fd5b5060ff8135811691602081013582169160408201358116916060013516620017ec565b348015620006d157600080fd5b506200022f62001a04565b348015620006e957600080fd5b506200022f62001a10565b3480156200070157600080fd5b50620004ba62001a16565b3480156200071957600080fd5b50620004ba62001a78565b3480156200073157600080fd5b506200025962001d7b565b3480156200074957600080fd5b506200033d600480360360808110156200076257600080fd5b5080356001600160a01b03908116916020810135909116906040810135906060013560ff1662001fc1565b3480156200079a57600080fd5b506200033d60048036036020811015620007b357600080fd5b5035620021ab565b348015620007c857600080fd5b5062000259620021d3565b348015620007e057600080fd5b50620007eb6200223b565b6040805161ffff9092168252519081900360200190f35b6200025962002240565b3480156200081957600080fd5b506200030f600480360360208110156200083257600080fd5b503560ff1662002758565b3480156200084a57600080fd5b506200022f600480360360208110156200086357600080fd5b50356001600160a01b03166200276d565b3480156200088157600080fd5b506200033d6200277f565b671bc16d674ec8000081565b6000339050806001600160a01b031660076000836001600160a01b0316633a5381b56040518163ffffffff1660e01b815260040160206040518083038186803b158015620008e557600080fd5b505afa158015620008fa573d6000803e3d6000fd5b505050506040513d60208110156200091157600080fd5b50516001600160a01b03908116825260208201929092526040016000205416146200097e576040805162461bcd60e51b8152602060048201526018602482015277159bdd19481c1bdbdb081b9bdd081c9959da5cdd195c995960421b604482015290519081900360640190fd5b336001816001600160a01b031663c19d93fb6040518163ffffffff1660e01b815260040160206040518083038186803b158015620009bb57600080fd5b505afa158015620009d0573d6000803e3d6000fd5b505050506040513d6020811015620009e757600080fd5b50516003811115620009f557fe5b1462000a3a576040805162461bcd60e51b815260206004820152600f60248201526e496e636f727265637420737461746560881b604482015290519081900360640190fd5b6000600a6000836001600160a01b031663683c529c6040518163ffffffff1660e01b815260040160206040518083038186803b15801562000a7a57600080fd5b505afa15801562000a8f573d6000803e3d6000fd5b505050506040513d602081101562000aa657600080fd5b5051600181111562000ab457fe5b600181111562000ac057fe5b81526020810191909152604001600020905062000ade818362002793565b505050565b60005460ff1681565b606481565b60005461010090046001600160a01b0316331462000b43576040805162461bcd60e51b815260206004820152600a60248201526927b7363c9030b236b4b760b11b604482015290519081900360640190fd5b6001600160a01b038281166000908152600760205260409020541662000b9b5760405162461bcd60e51b8152600401808060200182810382526021815260200180620061796021913960400191505060405180910390fd5b6001600160a01b03808316600090815260076020526040808220548151638ec7a23d60e01b815285151560048201529151931692638ec7a23d9260248084019391929182900301818387803b15801562000bf457600080fd5b505af115801562000c09573d6000803e3d6000fd5b505050505050565b60016020526000908152604090205460ff1681565b61f00681565b60005460ff161562000c7b576040805162461bcd60e51b8152602060048201526013602482015272105b1c9958591e481a5b9a5d1a585b1a5e9959606a1b604482015290519081900360640190fd5b6000835111801562000c8e575081518351145b62000cd1576040805162461bcd60e51b815260206004820152600e60248201526d496e76616c696420706172616d7360901b604482015290519081900360640190fd5b6001600160a01b03811662000d25576040805162461bcd60e51b8152602060048201526015602482015274496e76616c69642061646d696e206164647265737360581b604482015290519081900360640190fd5b60008054600160ff199091168117610100600160a81b0319166101006001600160a01b038516021782558180600181111562000d5d57fe5b815260200190815260200160002060006101000a81548160ff021916908360ff16021790555060056001600060018081111562000d9657fe5b600181111562000da257fe5b81526020808201929092526040016000908120805460ff9490941660ff1994851617905560029091527fac33ff75c19e70fe83507db0d683fd3465c996598dc972688b7ace676c89077b805483169055600181527fe90b7bceb6e7df5418fb78d8ee546e97c83a08bbccc01a0644d599ccd2a7c2e080549092169091555b83518160ff1610156200101d576000848260ff168151811062000e3f57fe5b6020908102919091018101516001600160a01b0380821660009081526007909352604090922054909250161562000eb9576040805162461bcd60e51b815260206004820152601960248201527856616c696461746f727320616c72656164792065786973747360381b604482015290519081900360640190fd5b600081858460ff168151811062000ecc57fe5b602002602001015161271060018060405162000ee89062003568565b80866001600160a01b03168152602001856001600160a01b0316815260200184815260200183600181111562000f1a57fe5b815260200182600381111562000f2c57fe5b815260200195505050505050604051809103906000f08015801562000f55573d6000803e3d6000fd5b5060068054600181019091557ff652222313e28459528d920b65115c16c04f3efc82aaedc97be59f3f377c0d3f0180546001600160a01b038086166001600160a01b031992831681179093556000928352600760205260408084208054928616929093168217909255815163204a7f0760e21b8152915193945092638129fc1c9260048084019391929182900301818387803b15801562000ff557600080fd5b505af11580156200100a573d6000803e3d6000fd5b50506001909401935062000e2092505050565b50505050565b606060048054806020026020016040519081016040528092919081815260200182805480156200107d57602002820191906000526020600020905b81546001600160a01b031681526001909101906020018083116200105e575b5050505050905090565b6007602052600090815260409020546001600160a01b031681565b334114620010e4576040805162461bcd60e51b815260206004820152600a6024820152694d696e6572206f6e6c7960b01b604482015290519081900360640190fd5b436000908152600b60209081526040808320600180855292529091205460ff16156200114a576040805162461bcd60e51b815260206004820152601060248201526f105b1c9958591e481bdc195c985d195960821b604482015290519081900360640190fd5b818043816200115557fe5b06156200119c576040805162461bcd60e51b815260206004820152601060248201526f426c6f636b2065706f6368206f6e6c7960801b604482015290519081900360640190fd5b60005460ff16620011e3576040805162461bcd60e51b815260206004820152600c60248201526b139bdd081a5b9a5d081e595d60a21b604482015290519081900360640190fd5b436000908152600b60209081526040808320600180855292528220805460ff191690911790555b60035460ff821610156200126f5760006005600060038460ff16815481106200122f57fe5b6000918252602080832091909101546001600160a01b031683528201929092526040019020805460ff191660ff929092169190911790556001016200120a565b5083516200128590600390602087019062003576565b5060005b60035460ff82161015620012ee5760016005600060038460ff1681548110620012ae57fe5b6000918252602080832091909101546001600160a01b031683528201929092526040019020805460ff191660ff9290921691909117905560010162001289565b50620012fd60046000620035e0565b6200130762003603565b50604080518082019091526000808252600160208301525b60028160ff16101562000c0957600060026000848460ff16600281106200134257fe5b602002015160018111156200135357fe5b60018111156200135f57fe5b815260200190815260200160002060009054906101000a900460ff1690506000600a6000858560ff16600281106200139357fe5b60200201516001811115620013a457fe5b6001811115620013b057fe5b8152602081019190915260400160002080549091506001600160a01b03165b60008360ff16118015620013eb57506001600160a01b03811615155b15620015475760056000826001600160a01b0316633a5381b56040518163ffffffff1660e01b815260040160206040518083038186803b1580156200142f57600080fd5b505afa15801562001444573d6000803e3d6000fd5b505050506040513d60208110156200145b57600080fd5b50516001600160a01b0316815260208101919091526040016000205460ff1662001524576004816001600160a01b0316633a5381b56040518163ffffffff1660e01b815260040160206040518083038186803b158015620014bb57600080fd5b505afa158015620014d0573d6000803e3d6000fd5b505050506040513d6020811015620014e757600080fd5b505181546001810183556000928352602090922090910180546001600160a01b0319166001600160a01b0390921691909117905560001992909201915b6001600160a01b03908116600090815260038301602052604090205416620013cf565b5050506001016200131f565b61f00581565b6000339050806001600160a01b031660076000836001600160a01b0316633a5381b56040518163ffffffff1660e01b815260040160206040518083038186803b158015620015a657600080fd5b505afa158015620015bb573d6000803e3d6000fd5b505050506040513d6020811015620015d257600080fd5b50516001600160a01b03908116825260208201929092526040016000205416146200163f576040805162461bcd60e51b8152602060048201526018602482015277159bdd19481c1bdbdb081b9bdd081c9959da5cdd195c995960421b604482015290519081900360640190fd5b60003390506000600a6000836001600160a01b031663683c529c6040518163ffffffff1660e01b815260040160206040518083038186803b1580156200168457600080fd5b505afa15801562001699573d6000803e3d6000fd5b505050506040513d6020811015620016b057600080fd5b50516001811115620016be57fe5b6001811115620016ca57fe5b81526020810191909152604001600020905062000ade818362002d51565b670de0b6b3a764000081565b806001600160a01b03811662001743576040805162461bcd60e51b815260206004820152600f60248201526e496e76616c6964206164647265737360881b604482015290519081900360640190fd5b60005461010090046001600160a01b0316331462001795576040805162461bcd60e51b815260206004820152600a60248201526927b7363c9030b236b4b760b11b604482015290519081900360640190fd5b60008054610100600160a81b0319166101006001600160a01b03858116820292909217808455604051919004909116917f927cc064d7b7fa546fa7706bc01845d27d06f15af3ae90a672cc44735928e96191a25050565b60005461010090046001600160a01b031633146200183e576040805162461bcd60e51b815260206004820152600a60248201526927b7363c9030b236b4b760b11b604482015290519081900360640190fd5b60ff848301166005146200188a576040805162461bcd60e51b815260206004820152600e60248201526d496e76616c696420636f756e747360901b604482015290519081900360640190fd5b8360ff168360ff1611158015620018a757508160ff168160ff1611155b620018f1576040805162461bcd60e51b8152602060048201526015602482015274496e76616c6964206261636b757020636f756e747360581b604482015290519081900360640190fd5b7fa6eef7e35abe7026729641147f7915573c7e97b47efa546f5f6e3230263bcb49805460ff86811660ff1992831681179093557fcc69885fda6bcc1a4ace058b4a62bf5e179ea78fd58a1ccd71c22cc9b688792f80548683169084168117909155600260209081527fac33ff75c19e70fe83507db0d683fd3465c996598dc972688b7ace676c89077b8054851689851690811790915560016000527fe90b7bceb6e7df5418fb78d8ee546e97c83a08bbccc01a0644d599ccd2a7c2e080549095169387169384179094556040805195865290850193909352838301526060830152517fef8fc40942f0314a9f5ebd7832ff1b78e6c4b5b7062355066b0c0e3e0edc6f29916080908290030190a150505050565b6729a2241af62c000081565b60065490565b606060038054806020026020016040519081016040528092919081815260200182805480156200107d576020028201919060005260206000209081546001600160a01b031681526001909101906020018083116200105e575050505050905090565b6060600062001a8662003603565b50604080518082019091526000808252600160208301525b60028160ff16101562001b99576000828260ff166002811062001abd57fe5b602002015190506000600a600083600181111562001ad757fe5b600181111562001ae357fe5b815260200190815260200160002090506001600083600181111562001b0457fe5b600181111562001b1057fe5b8152602081019190915260400160002054600182015460ff918216600160a01b909104909116101562001b57576001810154600160a01b900460ff16949094019362001b8e565b6001600083600181111562001b6857fe5b600181111562001b7457fe5b815260208101919091526040016000205460ff1694909401935b505060010162001a9e565b5060608260ff1667ffffffffffffffff8111801562001bb757600080fd5b5060405190808252806020026020018201604052801562001be2578160200160208202803683370190505b5090506000805b60028160ff16101562001d71576000848260ff166002811062001c0857fe5b602002015190506000600a600083600181111562001c2257fe5b600181111562001c2e57fe5b8152602001908152602001600020905060006001600084600181111562001c5157fe5b600181111562001c5d57fe5b8152602081019190915260400160002054825460ff90911691506001600160a01b03165b60008260ff1611801562001c9d57506001600160a01b03811615155b1562001d6057806001600160a01b0316633a5381b56040518163ffffffff1660e01b815260040160206040518083038186803b15801562001cdd57600080fd5b505afa15801562001cf2573d6000803e3d6000fd5b505050506040513d602081101562001d0957600080fd5b50518751889060ff891690811062001d1d57fe5b6001600160a01b03928316602091820292909201810191909152918116600090815260038501909252604090912054600190960195600019909201911662001c81565b50506001909201915062001be99050565b5090935050505090565b6000339050806001600160a01b031660076000836001600160a01b0316633a5381b56040518163ffffffff1660e01b815260040160206040518083038186803b15801562001dc857600080fd5b505afa15801562001ddd573d6000803e3d6000fd5b505050506040513d602081101562001df457600080fd5b50516001600160a01b039081168252602082019290925260400160002054161462001e61576040805162461bcd60e51b8152602060048201526018602482015277159bdd19481c1bdbdb081b9bdd081c9959da5cdd195c995960421b604482015290519081900360640190fd5b336001816001600160a01b031663c19d93fb6040518163ffffffff1660e01b815260040160206040518083038186803b15801562001e9e57600080fd5b505afa15801562001eb3573d6000803e3d6000fd5b505050506040513d602081101562001eca57600080fd5b5051600381111562001ed857fe5b1462001f1d576040805162461bcd60e51b815260206004820152600f60248201526e496e636f727265637420737461746560881b604482015290519081900360640190fd5b6000600a6000836001600160a01b031663683c529c6040518163ffffffff1660e01b815260040160206040518083038186803b15801562001f5d57600080fd5b505afa15801562001f72573d6000803e3d6000fd5b505050506040513d602081101562001f8957600080fd5b5051600181111562001f9757fe5b600181111562001fa357fe5b81526020810191909152604001600020905062000ade818362002f46565b6000805461010090046001600160a01b0316331462002014576040805162461bcd60e51b815260206004820152600a60248201526927b7363c9030b236b4b760b11b604482015290519081900360640190fd5b6001600160a01b0385811660009081526007602052604090205416156200207e576040805162461bcd60e51b815260206004820152601960248201527856616c696461746f727320616c72656164792065786973747360381b604482015290519081900360640190fd5b6000858585856000604051620020949062003568565b80866001600160a01b03168152602001856001600160a01b03168152602001848152602001836001811115620020c657fe5b8152602001826003811115620020d857fe5b815260200195505050505050604051809103906000f08015801562002101573d6000803e3d6000fd5b5060068054600181019091557ff652222313e28459528d920b65115c16c04f3efc82aaedc97be59f3f377c0d3f0180546001600160a01b03808a166001600160a01b03199283168117909355600083815260076020908152604091829020805493871693909416831790935580519182525193945091927f1ab57f2e2a6e4069160cc6501d8012d93ed435770b1ed646f82482a2f7234ff49281900390910190a295945050505050565b60068181548110620021b957fe5b6000918252602090912001546001600160a01b0316905081565b3360009081526009602052604090205480620021f0575062002239565b336000818152600960205260408082208290558051600162c261b160e01b03198152905163ff3d9e4f9285926004808201939182900301818588803b15801562000bf457600080fd5b565b600581565b33411462002282576040805162461bcd60e51b815260206004820152600a6024820152694d696e6572206f6e6c7960b01b604482015290519081900360640190fd5b436000908152600b6020908152604080832083805290915281205460ff1615620022e6576040805162461bcd60e51b815260206004820152601060248201526f105b1c9958591e481bdc195c985d195960821b604482015290519081900360640190fd5b60005460ff166200232d576040805162461bcd60e51b815260206004820152600c60248201526b139bdd081a5b9a5d081e595d60a21b604482015290519081900360640190fd5b436000908152600b602090815260408083208380529091528120805460ff19166001179055600854620023629034906200331a565b905060006200238060646200237984600a6200337e565b90620033dc565b90506000620023976064620023798560286200337e565b90506000620023ae6064620023798660326200337e565b60045490915015620025b8576000805b60045460ff8216101562002485576200247a6007600060048460ff1681548110620023e557fe5b60009182526020808320909101546001600160a01b03908116845283820194909452604092830190912054825163f1cea4c760e01b8152925193169263f1cea4c7926004808201939291829003018186803b1580156200244457600080fd5b505afa15801562002459573d6000803e3d6000fd5b505050506040513d60208110156200247057600080fd5b505183906200331a565b9150600101620023be565b508015620025b65760005b60045460ff82161015620025b45760006007600060048460ff1681548110620024b557fe5b60009182526020808320909101546001600160a01b039081168452838201949094526040928301822054835163f1cea4c760e01b815293519416945090926200255a9287926200237992879263f1cea4c7926004808301939192829003018186803b1580156200252457600080fd5b505afa15801562002539573d6000803e3d6000fd5b505050506040513d60208110156200255057600080fd5b50518a906200337e565b6001600160a01b0383166000908152600960205260409020549091506200258290826200331a565b6001600160a01b038316600090815260096020526040902055620025a7888262003420565b9750505060010162002490565b505b505b600354156200274f576000805b60035460ff82161015620025f757620025ec6007600060038460ff1681548110620023e557fe5b9150600101620025c5565b5060005b60035460ff821610156200274c5760006007600060038460ff16815481106200262057fe5b60009182526020808320909101546001600160a01b03908116845290830193909352604090910181205460035492169250906200265f908690620033dc565b90508315620026f5576000620026e3856200237989866001600160a01b031663f1cea4c76040518163ffffffff1660e01b815260040160206040518083038186803b158015620026ae57600080fd5b505afa158015620026c3573d6000803e3d6000fd5b505050506040513d6020811015620026da57600080fd5b5051906200337e565b9050620026f182826200331a565b9150505b6001600160a01b0382166000908152600960205260409020546200271a90826200331a565b6001600160a01b0383166000908152600960205260409020556200273f888262003420565b97505050600101620025fb565b50505b50505060085550565b60026020526000908152604090205460ff1681565b60096020526000908152604090205481565b60005461010090046001600160a01b031681565b6001820154600160a01b900460ff16620027f85781546001600160a01b0382166001600160a01b0319918216811784556001808501805460ff600160a01b91909516909317838104851690920190931690910260ff60a01b1990911617905562002d4d565b81546001600160a01b0382811691161415620028145762002d4d565b6001600160a01b0380821660009081526002840160205260409020541680620029bd576001808401805460ff600160a01b80830482169094011690920260ff60a01b1990921691909117908190556040805163f1cea4c760e01b815290516001600160a01b039092169163f1cea4c791600480820192602092909190829003018186803b158015620028a557600080fd5b505afa158015620028ba573d6000803e3d6000fd5b505050506040513d6020811015620028d157600080fd5b50516040805163f1cea4c760e01b815290516001600160a01b0385169163f1cea4c7916004808301926020929190829003018186803b1580156200291457600080fd5b505afa15801562002929573d6000803e3d6000fd5b505050506040513d60208110156200294057600080fd5b505111620029a857506001820180546001600160a01b038381166000818152600287016020908152604080832080549686166001600160a01b031997881617905586549094168252600388019052919091208054831682179055825490911617905562002d4d565b5060018201546001600160a01b031662002b54565b806001600160a01b031663f1cea4c76040518163ffffffff1660e01b815260040160206040518083038186803b158015620029f757600080fd5b505afa15801562002a0c573d6000803e3d6000fd5b505050506040513d602081101562002a2357600080fd5b50516040805163f1cea4c760e01b815290516001600160a01b0385169163f1cea4c7916004808301926020929190829003018186803b15801562002a6657600080fd5b505afa15801562002a7b573d6000803e3d6000fd5b505050506040513d602081101562002a9257600080fd5b50511162002aa1575062002d4d565b6001600160a01b038083166000818152600386016020526040808220548585168352912080546001600160a01b0319169184169190911790556001850154909116141562002b0c576001830180546001600160a01b0319166001600160a01b03831617905562002b54565b6001600160a01b03808316600090815260028501602081815260408084205460038901835281852054861685529290915290912080546001600160a01b031916919092161790555b6001600160a01b0381161580159062002c415750806001600160a01b031663f1cea4c76040518163ffffffff1660e01b815260040160206040518083038186803b15801562002ba257600080fd5b505afa15801562002bb7573d6000803e3d6000fd5b505050506040513d602081101562002bce57600080fd5b50516040805163f1cea4c760e01b815290516001600160a01b0385169163f1cea4c7916004808301926020929190829003018186803b15801562002c1157600080fd5b505afa15801562002c26573d6000803e3d6000fd5b505050506040513d602081101562002c3d57600080fd5b5051115b1562002c6a576001600160a01b0390811660009081526002840160205260409020541662002b54565b6001600160a01b03811662002ce05782546001600160a01b038381166000818152600387016020908152604080832080549686166001600160a01b031997881617905588549094168252600288019052828120805485168317905581815291909120805483169055845490911617835562000ade565b6001600160a01b0390811660008181526003850160209081526040808320805487871680865283862080549289166001600160a01b031993841617905582549097168552600289019093528184208054841687179055805483168617905593825292902080549092161790555b5050565b81546001600160a01b0382811691161480159062002d8957506001600160a01b03818116600090815260028401602052604090205416155b1562002d955762002d4d565b60018201546001600160a01b038281169116141562002de2576001600160a01b0380821660009081526002840160205260409020546001840180546001600160a01b031916919092161790555b81546001600160a01b038281169116141562002e26576001600160a01b03808216600090815260038401602052604090205483546001600160a01b03191691161782555b6001600160a01b03808216600090815260038401602052604090205416801562002e82576001600160a01b038083166000908152600285016020526040808220548484168352912080546001600160a01b031916919092161790555b6001600160a01b03808316600090815260028501602052604090205416801562002ede576001600160a01b038084166000908152600386016020526040808220548484168352912080546001600160a01b031916919092161790555b50506001600160a01b03166000908152600282016020908152604080832080546001600160a01b03199081169091556003850190925290912080549091169055600101805460ff60a01b198116600160a01b9182900460ff9081166000190116909102179055565b6001600160a01b03808216600081815260038501602052604090205460018501549083169216148062002f8057506001600160a01b038116155b80620030615750816001600160a01b031663f1cea4c76040518163ffffffff1660e01b815260040160206040518083038186803b15801562002fc157600080fd5b505afa15801562002fd6573d6000803e3d6000fd5b505050506040513d602081101562002fed57600080fd5b50516040805163f1cea4c760e01b815290516001600160a01b0384169163f1cea4c7916004808301926020929190829003018186803b1580156200303057600080fd5b505afa15801562003045573d6000803e3d6000fd5b505050506040513d60208110156200305c57600080fd5b505111155b156200306e575062002d4d565b6001600160a01b038083166000818152600286016020526040808220548585168352912080546001600160a01b03191691841691909117905584549091161415620030d25782546001600160a01b0319166001600160a01b03821617835562003114565b6001600160a01b0382811660009081526002850160209081526040808320548416835260038701909152902080546001600160a01b0319169183169190911790555b6001600160a01b03811615801590620032015750816001600160a01b031663f1cea4c76040518163ffffffff1660e01b815260040160206040518083038186803b1580156200316257600080fd5b505afa15801562003177573d6000803e3d6000fd5b505050506040513d60208110156200318e57600080fd5b50516040805163f1cea4c760e01b815290516001600160a01b0384169163f1cea4c7916004808301926020929190829003018186803b158015620031d157600080fd5b505afa158015620031e6573d6000803e3d6000fd5b505050506040513d6020811015620031fd57600080fd5b5051115b156200322a576001600160a01b0390811660009081526003840160205260409020541662003114565b6001600160a01b038116620032a2576001830180546001600160a01b038481166000818152600288016020908152604080832080549686166001600160a01b031997881617905560038a0190915280822080548616905585549093168152919091208054831682179055825490911617905562000ade565b6001600160a01b0390811660008181526002850160208181526040808420805487168552600390980180835281852080546001600160a01b0319908116998916998a17909155848452895489875283872080549190991690821617909755825283208054861685179055929091529052825416179055565b60008282018381101562003375576040805162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604482015290519081900360640190fd5b90505b92915050565b6000826200338f5750600062003378565b828202828482816200339d57fe5b0414620033755760405162461bcd60e51b8152600401808060200182810382526021815260200180620061586021913960400191505060405180910390fd5b60006200337583836040518060400160405280601a81526020017f536166654d6174683a206469766973696f6e206279207a65726f00000000000081525062003464565b60006200337583836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f7700008152506200350b565b60008183620034f45760405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b83811015620034b85781810151838201526020016200349e565b50505050905090810190601f168015620034e65780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b5060008385816200350157fe5b0495945050505050565b60008184841115620035605760405162461bcd60e51b8152602060048201818152835160248401528351909283926044909101919085019080838360008315620034b85781810151838201526020016200349e565b505050900390565b612afe806200365a83390190565b828054828255906000526020600020908101928215620035ce579160200282015b82811115620035ce57825182546001600160a01b0319166001600160a01b0390911617825560209092019160019091019062003597565b50620035dc92915062003621565b5090565b508054600082559060005260206000209081019062003600919062003642565b50565b60405180604001604052806002906020820280368337509192915050565b5b80821115620035dc5780546001600160a01b031916815560010162003622565b5b80821115620035dc57600081556001016200364356fe60806040523480156200001157600080fd5b5060405162002afe38038062002afe833981810160405260a08110156200003757600080fd5b50805160208201516040830151606084015160809094015160018055929391929091903361f00514620000b1576040805162461bcd60e51b815260206004820152601860248201527f56616c696461746f727320636f6e7472616374206f6e6c790000000000000000604482015290519081900360640190fd5b846001600160a01b03811662000100576040805162461bcd60e51b815260206004820152600f60248201526e496e76616c6964206164647265737360881b604482015290519081900360640190fd5b846001600160a01b0381166200014f576040805162461bcd60e51b815260206004820152600f60248201526e496e76616c6964206164647265737360881b604482015290519081900360640190fd5b838560018260018111156200016057fe5b1415620001b757612710811115620001b1576040805162461bcd60e51b815260206004820152600f60248201526e125b9d985b1a59081c195c98d95b9d608a1b604482015290519081900360640190fd5b62000235565b620001ee600a620001da6003612710620002c660201b6200225a1790919060201c565b6200032d60201b620022bc1790919060201c565b81111562000235576040805162461bcd60e51b815260206004820152600f60248201526e125b9d985b1a59081c195c98d95b9d608a1b604482015290519081900360640190fd5b6002805462010000600160b01b031916620100006001600160a01b038c81169190910291909117808355600380546001600160a01b031916928c1692909217909155600589905587919060ff1916600183818111156200029157fe5b02179055506002805486919061ff001916610100836003811115620002b257fe5b02179055505050505050505050506200041e565b600082620002d75750600062000327565b82820282848281620002e557fe5b0414620003245760405162461bcd60e51b815260040180806020018281038252602181526020018062002add6021913960400191505060405180910390fd5b90505b92915050565b60006200032483836040518060400160405280601a81526020017f536166654d6174683a206469766973696f6e206279207a65726f0000000000008152506200037760201b60201c565b60008183620004075760405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b83811015620003cb578181015183820152602001620003b1565b50505050905090810190601f168015620003f95780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b5060008385816200041457fe5b0495945050505050565b6126af806200042e6000396000f3fe6080604052600436106102305760003560e01c80638129fc1c1161012e578063ba26d9ff116100ab578063ec0cb3361161006f578063ec0cb33614610285578063f06d5e7714610614578063f1cea4c71461063e578063f3b1cc6714610285578063ff3d9e4f1461065357610230565b8063ba26d9ff14610591578063c19d93fb146105a6578063c967f90f146105cb578063d0e30db0146105f7578063e9fad8ee146105ff57610230565b806397a8ccd5116100f257806397a8ccd5146104d35780639e83d5b1146104db578063a3ec138d146104f0578063a3fbbaae14610549578063a66066791461057c57610230565b80638129fc1c14610453578063826d3dec146104685780638ec7a23d1461047d5780638f76691a146104a95780639001eed8146104be57610230565b806344f99900116101bc578063683c529c11610180578063683c529c146103b457806370ba1113146103ea57806371a1bb75146103ff57806372a11da414610414578063741579b11461043e57610230565b806344f999001461033a578063481c6a751461034f578063483a00e8146103645780634df9d6ba1461036c57806358fd41ea1461039f57610230565b80632b8aba7a116102035780632b8aba7a146102af5780632e4f67e4146102855780633a5381b5146102c45780633ccfd60b146102f557806341f4ca621461030c57610230565b806303fab4f614610235578063158ef93e1461025c57806315de360e1461028557806324c5b1ca1461029a575b600080fd5b34801561024157600080fd5b5061024a61065b565b60408051918252519081900360200190f35b34801561026857600080fd5b50610271610667565b604080519115158252519081900360200190f35b34801561029157600080fd5b5061024a610670565b3480156102a657600080fd5b5061024a610675565b3480156102bb57600080fd5b5061024a61067b565b3480156102d057600080fd5b506102d9610681565b604080516001600160a01b039092168252519081900360200190f35b34801561030157600080fd5b5061030a610696565b005b34801561031857600080fd5b50610321610812565b6040805192835260208301919091528051918290030190f35b34801561034657600080fd5b506102d961081b565b34801561035b57600080fd5b506102d9610821565b61030a610830565b34801561037857600080fd5b5061024a6004803603602081101561038f57600080fd5b50356001600160a01b0316610b17565b3480156103ab57600080fd5b5061024a610c3c565b3480156103c057600080fd5b506103c9610cdf565b604051808260018111156103d957fe5b815260200191505060405180910390f35b3480156103f657600080fd5b5061024a610ce8565b34801561040b57600080fd5b506102d9610cee565b34801561042057600080fd5b5061030a6004803603602081101561043757600080fd5b5035610cf4565b34801561044a57600080fd5b5061024a611013565b34801561045f57600080fd5b5061030a61101f565b34801561047457600080fd5b5061030a61111b565b34801561048957600080fd5b5061030a600480360360208110156104a057600080fd5b503515156112ad565b3480156104b557600080fd5b5061024a61149b565b3480156104ca57600080fd5b5061024a6114a1565b61030a6114ad565b3480156104e757600080fd5b5061030a61163b565b3480156104fc57600080fd5b506105236004803603602081101561051357600080fd5b50356001600160a01b0316611836565b604080519485526020850193909352838301919091526060830152519081900360800190f35b34801561055557600080fd5b5061030a6004803603602081101561056c57600080fd5b50356001600160a01b031661185d565b34801561058857600080fd5b5061030a611905565b34801561059d57600080fd5b5061030a611acc565b3480156105b257600080fd5b506105bb611c02565b604051808260038111156103d957fe5b3480156105d757600080fd5b506105e0611c10565b6040805161ffff9092168252519081900360200190f35b61030a611c15565b34801561060b57600080fd5b5061030a611e9d565b34801561062057600080fd5b5061030a6004803603602081101561063757600080fd5b503561204a565b34801561064a57600080fd5b5061024a61219a565b61030a6121a0565b671bc16d674ec8000081565b60005460ff1681565b606481565b600d5481565b600c5481565b6002546201000090046001600160a01b031681565b600260015414156106dc576040805162461bcd60e51b815260206004820152601f60248201526000805160206125df833981519152604482015290519081900360640190fd5b6002600155336000908152600960205260409020600301546064906107029043906122fe565b11610749576040805162461bcd60e51b8152602060048201526012602482015271125b9d195c9d985b081d1bdbc81cdb585b1b60721b604482015290519081900360640190fd5b336000908152600960205260409020600201546107a8576040805162461bcd60e51b815260206004820152601860248201527756616c75652073686f756c64206e6f74206265207a65726f60401b604482015290519081900360640190fd5b33600081815260096020526040812060028101805490839055600390910191909155906107d59082612340565b60408051828152905133917f884edad9ce6fa2440d8a54cc123490eb96d2768479d49ff9c7366125a9424364919081900360200190a25060018055565b60065460075482565b61f00681565b6003546001600160a01b031681565b6003546001600160a01b03163314610886576040805162461bcd60e51b815260206004820152601460248201527313db9b1e481b585b9859d95c88185b1b1bddd95960621b604482015290519081900360640190fd5b61088e61242a565b6108d1576040805162461bcd60e51b815260206004820152600f60248201526e496e636f727265637420737461746560881b604482015290519081900360640190fd5b600d5415806108f4575060646108f2600d54436122fe90919063ffffffff16565b115b610940576040805162461bcd60e51b8152602060048201526018602482015277092dce8cae4ecc2d840dcdee840d8dedcce40cadcdeeaced60431b604482015290519081900360640190fd5b60003411610990576040805162461bcd60e51b815260206004820152601860248201527756616c75652073686f756c64206e6f74206265207a65726f60401b604482015290519081900360640190fd5b6000600d556004546109a29034612488565b60045560408051348152905133917f278e696bd0cd4a7d1260ced26c40cd01c2b088f441889e4148240ac81069b348919081900360200190a26000600160025460ff1660018111156109f057fe5b1415610a055750670de0b6b3a7640000610a10565b506729a2241af62c00005b8060045410610b14576002805461ff0019166101001790819055604080516363e1d45160e01b8152620100009092046001600160a01b031660048301525161f006916363e1d45191602480830192600092919082900301818387803b158015610a7857600080fd5b505af1158015610a8c573d6000803e3d6000fd5b5050505061f0056001600160a01b031663136ec0b36040518163ffffffff1660e01b8152600401600060405180830381600087803b158015610acd57600080fd5b505af1158015610ae1573d6000803e3d6000fd5b5050600254610100900460ff169150506003811115610afc57fe5b60405160008051602061263983398151915290600090a25b50565b60408051637a0787a960e11b81523060048201529051600091829161f0059163f40f0f52916024808301926020929190829003018186803b158015610b5b57600080fd5b505afa158015610b6f573d6000803e3d6000fd5b505050506040513d6020811015610b8557600080fd5b5051600554909150600090610ba99061271090610ba390859061225a565b906122bc565b600a54600b549192509015610bf057610bed81610be7600b54610ba3670de0b6b3a7640000610be1888a6122fe90919063ffffffff16565b9061225a565b90612488565b90505b6001600160a01b038516600090815260096020526040902060018101549054610c339190610c2d90670de0b6b3a764000090610ba390869061225a565b906122fe565b95945050505050565b60408051637a0787a960e11b81523060048201529051600091829161f0059163f40f0f52916024808301926020929190829003018186803b158015610c8057600080fd5b505afa158015610c94573d6000803e3d6000fd5b505050506040513d6020811015610caa57600080fd5b5051600554909150600090610cc89061271090610ba390859061225a565b600854909150610cd89082612488565b9250505090565b60025460ff1681565b60055481565b61f00581565b60026001541415610d3a576040805162461bcd60e51b815260206004820152601f60248201526000805160206125df833981519152604482015290519081900360640190fd5b600260015580610d8c576040805162461bcd60e51b815260206004820152601860248201527756616c75652073686f756c64206e6f74206265207a65726f60401b604482015290519081900360640190fd5b33600090815260096020526040902054811115610de6576040805162461bcd60e51b8152602060048201526013602482015272125b9cdd59999a58da595b9d08185b5bdd5b9d606a1b604482015290519081900360640190fd5b61f0056001600160a01b031663c885bc586040518163ffffffff1660e01b8152600401600060405180830381600087803b158015610e2357600080fd5b505af1158015610e37573d6000803e3d6000fd5b505033600090815260096020526040812060018101549054600a54929450610e7393509091610c2d91670de0b6b3a764000091610ba39161225a565b600b54909150610e8390836122fe565b600b5533600090815260096020526040902054610ea090836122fe565b336000908152600960205260409020819055600a54610ecd91670de0b6b3a764000091610ba3919061225a565b336000908152600960205260409020600190810191909155600254610100900460ff166003811115610efb57fe5b1415610f575761f0056001600160a01b031663bb8b65af6040518163ffffffff1660e01b8152600401600060405180830381600087803b158015610f3e57600080fd5b505af1158015610f52573d6000803e3d6000fd5b505050505b33600090815260096020526040902060020154610f749083612488565b336000818152600960205260409020600281019290925543600390920191909155610f9f9082612340565b60408051838152905133917f41b45db803eded5e27cdf3cbba5707b3575e9b6959de41c3f7b83b51ce600502919081900360200190a260408051828152905133917f7cddc560d4de1ea9d83e4123f01e6072afc503bb47bcc765f0396ba3861a0454919081900360200190a2505060018055565b670de0b6b3a764000081565b3361f00514611070576040805162461bcd60e51b815260206004820152601860248201527756616c696461746f727320636f6e7472616374206f6e6c7960401b604482015290519081900360640190fd5b60005460ff16156110be576040805162461bcd60e51b8152602060048201526013602482015272105b1c9958591e481a5b9a5d1a585b1a5e9959606a1b604482015290519081900360640190fd5b6000805460ff191660011781556040805163136ec0b360e01b8152905161f0059263136ec0b3926004808201939182900301818387803b15801561110157600080fd5b505af1158015611115573d6000803e3d6000fd5b50505050565b3361f00614611168576040805162461bcd60e51b815260206004820152601460248201527350756e69736820636f6e7472616374206f6e6c7960601b604482015290519081900360640190fd5b43600c5560028054610100900460ff16600381111561118357fe5b146111c4576002805461ff0019166103001790819055610100900460ff1660038111156111ac57fe5b60405160008051602061263983398151915290600090a25b61f0056001600160a01b03166371df76786040518163ffffffff1660e01b8152600401600060405180830381600087803b15801561120157600080fd5b505af1158015611215573d6000803e3d6000fd5b505050506000671bc16d674ec8000060045410156112355760045461123f565b671bc16d674ec800005b90508015610b145760045461125490826122fe565b600455611262600082612340565b600254604080518381529051620100009092046001600160a01b0316917febbcaaf6b9aa8b4083ae4b2f842c8de6f75319018e7b5e141a1e87aebadde6c3916020908290030190a250565b3361f005146112fe576040805162461bcd60e51b815260206004820152601860248201527756616c696461746f727320636f6e7472616374206f6e6c7960401b604482015290519081900360640190fd5b80156114045761130c61242a565b8061132c57506001600254610100900460ff16600381111561132a57fe5b145b61136f576040805162461bcd60e51b815260206004820152600f60248201526e496e636f727265637420737461746560881b604482015290519081900360640190fd5b6002805461ff0019166102001790819055610100900460ff16600381111561139357fe5b60405160008051602061263983398151915290600090a261f0056001600160a01b03166371df76786040518163ffffffff1660e01b8152600401600060405180830381600087803b1580156113e757600080fd5b505af11580156113fb573d6000803e3d6000fd5b50505050610b14565b60028054610100900460ff16600381111561141b57fe5b1461145f576040805162461bcd60e51b815260206004820152600f60248201526e496e636f727265637420737461746560881b604482015290519081900360640190fd5b6002805461ff00191690819055610100900460ff16600381111561147f57fe5b60405160008051602061263983398151915290600090a2610b14565b60045481565b6729a2241af62c000081565b600260015414156114f3576040805162461bcd60e51b815260206004820152601f60248201526000805160206125df833981519152604482015290519081900360640190fd5b60026001556003546001600160a01b0316331461154e576040805162461bcd60e51b815260206004820152601460248201527313db9b1e481b585b9859d95c88185b1b1bddd95960621b604482015290519081900360640190fd5b61f0056001600160a01b031663c885bc586040518163ffffffff1660e01b8152600401600060405180830381600087803b15801561158b57600080fd5b505af115801561159f573d6000803e3d6000fd5b505050506000600854116115eb576040805162461bcd60e51b815260206004820152600e60248201526d139bc81b5bdc99481c995dd85c9960921b604482015290519081900360640190fd5b6008805460009091556115fe3382612340565b60408051828152905133917fe4fc75e2b70d2f179fc77c722f2334ba1507c59932576ec9620b15dfb06d91e2919081900360200190a25060018055565b60026001541415611681576040805162461bcd60e51b815260206004820152601f60248201526000805160206125df833981519152604482015290519081900360640190fd5b60026001556003546001600160a01b031633146116dc576040805162461bcd60e51b815260206004820152601460248201527313db9b1e481b585b9859d95c88185b1b1bddd95960621b604482015290519081900360640190fd5b6116e461242a565b611727576040805162461bcd60e51b815260206004820152600f60248201526e496e636f727265637420737461746560881b604482015290519081900360640190fd5b6000600d5411801561174d5750606461174b600d54436122fe90919063ffffffff16565b115b611799576040805162461bcd60e51b8152602060048201526018602482015277092dce8cae4ecc2d840dcdee840d8dedcce40cadcdeeaced60431b604482015290519081900360640190fd5b6000600454116117e1576040805162461bcd60e51b815260206004820152600e60248201526d27379036b7b9329036b0b933b4b760911b604482015290519081900360640190fd5b6000600d819055600480549190556117f93382612340565b60408051828152905133917f5d3b8fa9823b18b176cfe79e002a5b931b8569313802f700eb8550bc6a353246919081900360200190a25060018055565b60096020526000908152604090208054600182015460028301546003909301549192909184565b6002546201000090046001600160a01b031633146118bb576040805162461bcd60e51b815260206004820152601660248201527513db9b1e481d985b1a59185d1bdc88185b1b1bddd95960521b604482015290519081900360640190fd5b600380546001600160a01b0319166001600160a01b0383169081179091556040517f5cd5185727f6057b7a274979ce4d902e15bf0ef1dc542d1fe5926cba874f63b690600090a250565b6003546001600160a01b0316331461195b576040805162461bcd60e51b815260206004820152601460248201527313db9b1e481b585b9859d95c88185b1b1bddd95960621b604482015290519081900360640190fd5b60025460065460ff90911690600182600181111561197557fe5b14156119c9576127108111156119c4576040805162461bcd60e51b815260206004820152600f60248201526e125b9d985b1a59081c195c98d95b9d608a1b604482015290519081900360640190fd5b611a21565b6119db600a610ba3612710600361225a565b811115611a21576040805162461bcd60e51b815260206004820152600f60248201526e125b9d985b1a59081c195c98d95b9d608a1b604482015290519081900360640190fd5b60075415801590611a405750600754606490611a3e9043906122fe565b115b611a8c576040805162461bcd60e51b8152602060048201526018602482015277092dce8cae4ecc2d840dcdee840d8dedcce40cadcdeeaced60431b604482015290519081900360640190fd5b600680546005819055600091829055600782905560405190917f450a792501c47863e89114cbdd0497acb22d4abfc51dc315afc323c5ba92d4a991a25050565b3361f00614611b19576040805162461bcd60e51b815260206004820152601460248201527350756e69736820636f6e7472616374206f6e6c7960601b604482015290519081900360640190fd5b61f0056001600160a01b031663c885bc586040518163ffffffff1660e01b8152600401600060405180830381600087803b158015611b5657600080fd5b505af1158015611b6a573d6000803e3d6000fd5b505050506000671bc16d674ec8000060085410611b8f57671bc16d674ec80000611b93565b6008545b600854909150611ba390826122fe565b6008558015610b1457611bb7600082612340565b600254604080518381529051620100009092046001600160a01b0316917f0a3c8b346f3f7fe5668c9f575473491c4274339e10c9548d7995f22211f988f0916020908290030190a250565b600254610100900460ff1681565b600581565b60026001541415611c5b576040805162461bcd60e51b815260206004820152601f60248201526000805160206125df833981519152604482015290519081900360640190fd5b600260018190555061f0056001600160a01b031663c885bc586040518163ffffffff1660e01b8152600401600060405180830381600087803b158015611ca057600080fd5b505af1158015611cb4573d6000803e3d6000fd5b505033600090815260096020526040812060018101549054600a54929450611cf093509091610c2d91670de0b6b3a764000091610ba39161225a565b90503415611e115733600090815260096020526040902054611d129034612488565b336000908152600960205260409020819055600a54611d3f91670de0b6b3a764000091610ba3919061225a565b33600090815260096020526040902060010155600b54611d5f9034612488565b600b5560408051348152905133917fe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c919081900360200190a26001600254610100900460ff166003811115611db057fe5b1415611e0c5761f0056001600160a01b031663136ec0b36040518163ffffffff1660e01b8152600401600060405180830381600087803b158015611df357600080fd5b505af1158015611e07573d6000803e3d6000fd5b505050505b611e4f565b600a5433600090815260096020526040902054611e3b91670de0b6b3a764000091610ba39161225a565b336000908152600960205260409020600101555b8015611e9657611e5f3382612340565b60408051828152905133917f7cddc560d4de1ea9d83e4123f01e6072afc503bb47bcc765f0396ba3861a0454919081900360200190a25b5060018055565b6003546001600160a01b03163314611ef3576040805162461bcd60e51b815260206004820152601460248201527313db9b1e481b585b9859d95c88185b1b1bddd95960621b604482015290519081900360640190fd5b6001600254610100900460ff166003811115611f0b57fe5b1480611f1a5750611f1a61242a565b611f5d576040805162461bcd60e51b815260206004820152600f60248201526e496e636f727265637420737461746560881b604482015290519081900360640190fd5b43600d556000600254610100900460ff166003811115611f7957fe5b1461200b576002805461ff00191690819055610100900460ff166003811115611f9e57fe5b60405160008051602061263983398151915290600090a261f0056001600160a01b03166371df76786040518163ffffffff1660e01b8152600401600060405180830381600087803b158015611ff257600080fd5b505af1158015612006573d6000803e3d6000fd5b505050505b600254604051620100009091046001600160a01b0316907f7c79e6e24ed041d1072d54523b53956f01b91b835f0490856370594d9d14470e90600090a2565b6003546001600160a01b031633146120a0576040805162461bcd60e51b815260206004820152601460248201527313db9b1e481b585b9859d95c88185b1b1bddd95960621b604482015290519081900360640190fd5b60025460ff168160018260018111156120b557fe5b141561210957612710811115612104576040805162461bcd60e51b815260206004820152600f60248201526e125b9d985b1a59081c195c98d95b9d608a1b604482015290519081900360640190fd5b612161565b61211b600a610ba3612710600361225a565b811115612161576040805162461bcd60e51b815260206004820152600f60248201526e125b9d985b1a59081c195c98d95b9d608a1b604482015290519081900360640190fd5b60068390554360075560405183907f2dcbffddb492dea86de0b18dac6d71f51a7b7a5ec946512e0c993a050f3b48ea90600090a2505050565b600b5481565b3361f005146121f1576040805162461bcd60e51b815260206004820152601860248201527756616c696461746f727320636f6e7472616374206f6e6c7960401b604482015290519081900360640190fd5b600061220e612710610ba36005543461225a90919063ffffffff16565b60085490915061221e9082612488565b600855600b5415610b1457612254600a54610be7600b54610ba3670de0b6b3a7640000610be187346122fe90919063ffffffff16565b600a5550565b600082612269575060006122b6565b8282028284828161227657fe5b04146122b35760405162461bcd60e51b81526004018080602001828103825260218152602001806126596021913960400191505060405180910390fd5b90505b92915050565b60006122b383836040518060400160405280601a81526020017f536166654d6174683a206469766973696f6e206279207a65726f0000000000008152506124e2565b60006122b383836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f770000815250612584565b80471015612395576040805162461bcd60e51b815260206004820152601d60248201527f416464726573733a20696e73756666696369656e742062616c616e6365000000604482015290519081900360640190fd5b6040516000906001600160a01b0384169083908381818185875af1925050503d80600081146123e0576040519150601f19603f3d011682016040523d82523d6000602084013e6123e5565b606091505b50509050806124255760405162461bcd60e51b815260040180806020018281038252603a8152602001806125ff603a913960400191505060405180910390fd5b505050565b600080600254610100900460ff16600381111561244357fe5b148061248357506003600254610100900460ff16600381111561246257fe5b14801561248357506064612481600c54436122fe90919063ffffffff16565b115b905090565b6000828201838110156122b3576040805162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604482015290519081900360640190fd5b6000818361256e5760405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b8381101561253357818101518382015260200161251b565b50505050905090810190601f1680156125605780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b50600083858161257a57fe5b0495945050505050565b600081848411156125d65760405162461bcd60e51b815260206004820181815283516024840152835190928392604490910191908501908083836000831561253357818101518382015260200161251b565b50505090039056fe5265656e7472616e637947756172643a207265656e7472616e742063616c6c00416464726573733a20756e61626c6520746f2073656e642076616c75652c20726563697069656e74206d61792068617665207265766572746564402ee26d4c255fcb07b0b7b5b93b77377832260977c25be44f3c8feffd2df70e536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f77a2646970667358221220493bed588e381b13412471c016f7bc1867c67dafa0f0b6f7159ee03bc3d3dba564736f6c634300060c0033536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f77536166654d6174683a206d756c7469706c69636174696f6e206f766572666c6f77436f72726573706f6e64696e6720766f746520706f6f6c206e6f7420666f756e64a264697066735822122083bfcbdd8931fc2b240003e9c73416b7c8883d387306ab5c1390b38d05baa16d64736f6c634300060c0033"
)

type hardForkValidatorsV1 struct {
}

func (s *hardForkValidatorsV1) GetName() string {
	return ValidatorsV1ContractName
}

func (s *hardForkValidatorsV1) Update(config *params.ChainConfig, height *big.Int, state *state.StateDB) (err error) {
	contractCode := common.FromHex(validatorV1Code)

	//write code to sys contract
	state.SetCode(ValidatorsV1ContractAddr, contractCode)
	log.Debug("Write code to system contract account", "addr", ValidatorsV1ContractAddr.String(), "code", validatorV1Code)

	return
}

func (s *hardForkValidatorsV1) getAdminByChainId(chainId *big.Int) common.Address {
	if chainId.Cmp(params.MainnetChainConfig.ChainID) == 0 {
		return validatorV1Admin
	}

	return validatorV1AdminTestnet
}

func (s *hardForkValidatorsV1) Execute(state *state.StateDB, header *types.Header, chainContext core.ChainContext, config *params.ChainConfig) (err error) {

	//First, get top validators from the old contract
	v0 := NewValidatorV0()
	topVals, err := v0.GetTopValidators(state, header, chainContext, config)
	if err != nil {
		log.Error("getTopValidators from V0 failed", "err", err)
		return err
	}
	managers := make([]common.Address, 0, len(topVals))
	for _, val := range topVals {
		feeAddr, err := v0.GetValidatorFeeAddr(val, state, header, chainContext, config)
		if err != nil {
			return err
		}
		managers = append(managers, feeAddr)
	}

	// initialize v1 contract
	method := "initialize"
	data, err := GetInteractiveABI()[ValidatorsV1ContractName].Pack(method, topVals, managers, s.getAdminByChainId(config.ChainID))
	if err != nil {
		log.Error("Can't pack data for initialize", "error", err)
		return err
	}

	msg := types.NewMessage(header.Coinbase, &ValidatorsV1ContractAddr, 0, new(big.Int), math.MaxUint64, new(big.Int), data, false)
	_, err = vmcaller.ExecuteMsg(msg, state, header, chainContext, config)

	return
}
